---
name: drawio
description: Create and edit draw.io diagrams in XML format. Use when the user wants to create flowcharts, architecture diagrams, sequence diagrams, or any visual diagrams. Handles .drawio, .drawio.svg formats, XML structure, styling, fonts (Noto Sans JP), arrows, connectors, and PNG export.
---

# Draw.io Diagram Skill

draw.ioファイル（.drawio / .drawio.svg）をXML形式で直接作成・編集するためのスキル。

## サポートファイル形式

- **.drawio**（ネイティブXML）: 生の mxfile XML。編集・バージョン管理に最適
- **.drawio.svg**（埋め込みSVG）: SVG + 埋め込み図データ。表示と編集の両立、ドキュメント埋め込み向け

## .drawio.svg形式の扱い

### 構造

`.drawio.svg` は **SVG（ベクター画像）＋ 埋め込み図データ** のハイブリッド形式。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<svg xmlns="http://www.w3.org/2000/svg" 
     width="2033px" height="963px" 
     content="&lt;mxfile ...&gt;&lt;diagram ...&gt;...&lt;/mxfile&gt;">
  <!-- SVG描画要素 -->
</svg>
```

- **`content` 属性**: HTMLエスケープされた mxfile XML が含まれる（`&lt;` = `<`、`&gt;` = `>`、`&#10;` = 改行）
- draw.io で開けば図として編集可能。通常の SVG ビューアでは画像として表示される

### 編集時のワークフロー

1. **draw.io で直接編集**: `.drawio.svg` を draw.io で開いて保存。図データは自動で更新される
2. **XML編集する場合**:
   - `content` 属性から mxfile を抽出（HTMLデコード）
   - mxfile 部分を `.drawio` と同様に編集
   - 編集後、HTMLエスケープして `content` に再埋め込み

### 補足

- ファイルサイズは `.drawio` より大きくなりやすい（SVG + 図データの二重保持）
- Git の差分は主に `content` 属性に現れる
- drawio CLI は `.drawio.svg` を入力として PNG 等へエクスポート可能

## XML基本構造

```xml
<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Claude" version="21.0.0">
  <diagram name="Page-1" id="page-1">
    <mxGraphModel dx="1000" dy="600" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0" defaultFontFamily="Noto Sans JP">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <!-- 図形要素をここに追加 -->
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
```

## mxCell要素

### 矩形（Rectangle）

```xml
<mxCell id="rect-1" value="ラベル" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Noto Sans JP;fontSize=18;" vertex="1" parent="1">
  <mxGeometry x="100" y="100" width="120" height="60" as="geometry" />
</mxCell>
```

### 角丸矩形（Rounded Rectangle）

```xml
<mxCell id="rounded-1" value="ラベル" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Noto Sans JP;fontSize=18;arcSize=20;" vertex="1" parent="1">
  <mxGeometry x="100" y="100" width="120" height="60" as="geometry" />
</mxCell>
```

### 楕円（Ellipse）

```xml
<mxCell id="ellipse-1" value="ラベル" style="ellipse;whiteSpace=wrap;html=1;fontFamily=Noto Sans JP;fontSize=18;" vertex="1" parent="1">
  <mxGeometry x="100" y="100" width="120" height="80" as="geometry" />
</mxCell>
```

### ひし形（Diamond）

```xml
<mxCell id="diamond-1" value="条件" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Noto Sans JP;fontSize=18;" vertex="1" parent="1">
  <mxGeometry x="100" y="100" width="100" height="100" as="geometry" />
</mxCell>
```

### テキスト（Text Only）

```xml
<mxCell id="text-1" value="テキスト" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Noto Sans JP;fontSize=18;" vertex="1" parent="1">
  <mxGeometry x="100" y="100" width="120" height="30" as="geometry" />
</mxCell>
```

## 矢印・コネクタ

### 基本の矢印

```xml
<mxCell id="arrow-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Noto Sans JP;fontSize=14;" edge="1" parent="1" source="rect-1" target="rect-2">
  <mxGeometry relative="1" as="geometry" />
</mxCell>
```

### ラベル付き矢印

```xml
<mxCell id="arrow-2" value="ラベル" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Noto Sans JP;fontSize=14;" edge="1" parent="1" source="rect-1" target="rect-2">
  <mxGeometry relative="1" as="geometry" />
</mxCell>
```

### 点線矢印

```xml
<mxCell id="arrow-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontFamily=Noto Sans JP;fontSize=14;" edge="1" parent="1" source="rect-1" target="rect-2">
  <mxGeometry relative="1" as="geometry" />
</mxCell>
```

## スタイル設定ガイド

### フォント設定（必須）

1. `mxGraphModel`に`defaultFontFamily="Noto Sans JP"`を設定
2. **すべてのテキスト要素**に`fontFamily=Noto Sans JP;`を明示的に追加

### 推奨設定

| 項目 | 推奨値 | 説明 |
|------|--------|------|
| fontSize | 18 | 標準の1.5倍、視認性向上 |
| 日本語テキスト幅 | 30-40px/文字 | レイアウト計算用 |
| 矢印とラベル間隔 | 20px以上 | 重なり防止 |

### 色設定

```
fillColor=#ffffff;      # 塗りつぶし色
strokeColor=#000000;    # 枠線色
fontColor=#333333;      # 文字色
```

### よく使う色

| 用途 | 色コード |
|------|----------|
| 白背景 | #ffffff |
| 薄い青 | #dae8fc |
| 薄い緑 | #d5e8d4 |
| 薄い黄 | #fff2cc |
| 薄い赤 | #f8cecc |
| 薄いグレー | #f5f5f5 |

## 配置ルール

### XMLの記述順 = 描画順

- **先に書いたものが背面**に配置される
- 矢印は図形より先（XMLの先頭側）に記述して最背面に配置

### 推奨構造

```xml
<root>
  <mxCell id="0" />
  <mxCell id="1" parent="0" />

  <!-- 1. 矢印・コネクタ（最背面） -->
  <mxCell id="arrow-1" ... edge="1" ... />
  <mxCell id="arrow-2" ... edge="1" ... />

  <!-- 2. 図形（中間） -->
  <mxCell id="rect-1" ... vertex="1" ... />
  <mxCell id="rect-2" ... vertex="1" ... />

  <!-- 3. テキストラベル（最前面） -->
  <mxCell id="text-1" ... vertex="1" ... />
</root>
```

## PNG変換

### drawio CLIコマンド

```bash
# .drawio の場合
drawio -x -f png -s 2 -t -o output.png input.drawio

# .drawio.svg の場合（同様に指定可能）
drawio -x -f png -s 2 -t -o output.png input.drawio.svg
```

| オプション | 説明 |
|------------|------|
| -x | エクスポートモード |
| -f png | PNG形式 |
| -s 2 | 2倍スケール（高解像度） |
| -t | 透明背景 |
| -o | 出力ファイル指定 |

> **Note**: `.drawio` と `.drawio.svg` の両方を入力として利用可能。

## 検証チェックリスト

作成後、以下を確認：

- [ ] 対象ファイル形式（.drawio / .drawio.svg）に応じた編集・保存ができているか
- [ ] mxGraphModelにdefaultFontFamilyが設定されているか
- [ ] 全テキスト要素にfontFamilyが明示的に設定されているか
- [ ] fontSizeは18px程度か（視認性）
- [ ] 矢印がXMLの先頭側に配置されているか（最背面）
- [ ] 矢印とラベルの間隔は20px以上か
- [ ] 日本語テキストの幅は十分か（30-40px/文字）
- [ ] PNG出力で視覚確認したか

## テンプレート

基本テンプレートは `templates/basic.drawio` を参照。
